angular.module("myApp",["ngRoute","ngCookies","myApp.env","myApp.loginSignup","myApp.auth","myApp.services","myApp.data","myApp.filters","myApp.header","myApp.headerDirective","myApp.footer","myApp.footerDirective","myApp.login","myApp.homepage","myApp.tracking","myApp.search"]).config(["$routeProvider",function(e){e.otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","Auth","$window",function(e,n,r,t){e.location=n,e.$on("$routeChangeStart",function(e,t,a){t.$$route&&t.$$route.authenticate&&!r.isAuth()&&(console.log("Please login before visiting "+t.$$route.originalPath),n.path("/login"))})}]),angular.module("myApp.env",[]).constant("FirebaseUrl","https://safran-tracker.firebaseio.com").constant("DevelopmentAPI","http://127.0.0.1:3000").constant("ProductionAPI","https://safran-tracker.herokuapp.com").constant("ServerAPI","https://safran-tracker.herokuapp.com"),angular.module("myApp.data",["firebase"]).factory("DataServices",["$timeout","$window","$http","$q","$rootScope","$cookies","ServerAPI","FirebaseUrl",function(e,n,r,t,a,o,i,l){resolve=function(e,n,r){a.$apply(function(){e?r.reject(e):r.resolve(n)})};var u=function(){var e=t.defer(),n=new Firebase(l+"/equipmentData");return n.orderByChild("date").limitToLast(6).once("value",function(n){resolve(null,n.val(),e)},function(n){resolve(n,null,e)}),promise=e.promise,promise},s=function(e,n){var r=t.defer(),a=new Firebase(l+"/equipmentData");return a.orderByChild(e).equalTo(n).limitToLast(10).once("value",function(e){resolve(null,e.val(),r)},function(e){resolve(e,null,r)}),promise=r.promise,promise},c=function(e,n){var r=t.defer(),a=new Firebase(l+"/equipmentData");return a.orderByChild(e).equalTo(n).once("value",function(e){resolve(null,e.val(),r)},function(e){resolve(e,null,r)}),promise=r.promise,promise},p=function(e){var n=t.defer(),r=new Firebase(l+"/equipmentData/"),a=new Firebase(l+"/equipmentList/"),o=new Date,i=o.getTime(),u={equipment:e.equipment,serial:e.serial,userName:e.userName,location:e.location,activity:e.activity,details:e.details,date:i};return u[e.equipment]=e.serial,r.push(u,function(r){if(r)resolve(r,null,n);else{var t={};t[e.serial]=e.serial,a.child(e.equipment).update(t,function(e){e?resolve(e,null,n):resolve(null,"ok",n)})}}),promise=n.promise,promise},m=function(e){var n=t.defer(),r=new Firebase(l+"/equipmentList/"+e);return r.once("value",function(e){resolve(null,e.val(),n)},function(e){resolve(e,null,n)}),promise=n.promise,promise};return{saveData:p,getLastestData:u,getLastestDataBySerial:s,getAllDataBySerial:c,searchFunction:m}}]),angular.module("myApp.filters",[]).filter("toArray",function(){return function(e,n){return angular.isObject(e)?n===!1?Object.keys(e).map(function(n){return e[n]}):Object.keys(e).map(function(n){var r=e[n];return angular.isObject(r)?Object.defineProperty(r,"$key",{enumerable:!1,value:n}):{$key:n,$value:r}}):e}}),angular.module("myApp.loginSignup",["firebase"]).factory("FirebaseAuth",["$firebaseAuth","FirebaseUrl",function(e,n){var r=new Firebase(n);return e(r)}]).factory("AuthServices",["$timeout","$location","$window","$http","$q","$rootScope","$cookies","ServerAPI","FirebaseAuth","$firebaseObject","FirebaseUrl",function(e,n,r,t,a,o,i,l,u,s,c){resolve=function(e,n,r){o.$apply(function(){e?r.reject(e):r.resolve(n)})};var p=function(){u.$unauth(),i.remove("safranCookie"),r.location.href="/"},m=function(n){var t=a.defer();return u.$authWithPassword({email:n.email,password:n.password}).then(function(n){e(function(){resolve(null,"ok",t)},0);var a=new Firebase(c+"/users/"+n.uid);a.once("value",function(e){var n=e.val(),t=new Date,a=new Date(t.getFullYear()+1,t.getMonth(),t.getDate()),o={fullName:n.fullName,email:n.email};i.put("safranCookie",JSON.stringify(o),{expires:a}),r.location.href="/"},function(n){e(function(){resolve(error,null,t)},0)})})["catch"](function(n){e(function(){resolve(n,null,t)},0)}),promise=t.promise,promise},f=function(e){return t({method:"GET",url:l+"/api/signup/"+e}).then(function(e){return e.data},function(e){return e.data={error:!0},e.data})},g=function(n){var t=a.defer();return u.$createUser({email:n.email,password:n.password}).then(function(a){var o=new Firebase(c+"/users/"+a.uid),l=s(o);l.fullName=n.fullName,l.email=n.email,l.$save().then(function(){e(function(){u.$authWithPassword({email:n.email,password:n.password}).then(function(a){e(function(){resolve(null,"ok",t)},0);var o=new Date,l=new Date(o.getFullYear()+1,o.getMonth(),o.getDate()),u={fullName:n.fullName,email:n.email};i.put("safranCookie",JSON.stringify(u),{expires:l}),r.location.href="/"})["catch"](function(n){e(function(){resolve(n,null,t)},0)})},0)})["catch"](function(n){e(function(){resolve(n,null,t)},0)})})["catch"](function(n){e(function(){resolve(n,null,t)},0)}),promise=t.promise,promise};return{login:m,logout:p,signup:g,checkSecret:f}}]),angular.module("myApp.services",[]).factory("Auth",["$http","$cookies",function(e,n){var r=function(){return!!n.get("safranCookie")},t=function(){var e=n.get("safranCookie"),r=JSON.parse(e),t={userName:r.fullName};return t};return{isAuth:r,getUserName:t}}]),angular.module("myApp.auth",[]).controller("AuthController",["$scope","$http","Auth","$cookies",function(e,n,r,t){e.safranCookie=!1;var a=t.get("safranCookie");if(a){var o=JSON.parse(a),i={userName:o.fullName};e.user=i}}]),angular.module("myApp.footerDirective",[]).directive("footerDirective",function(){return{templateUrl:"view/footer/footer.html"}}),angular.module("myApp.footer",[]).controller("footerController",["$scope",function(e){}]),angular.module("myApp.headerDirective",[]).directive("headerDirective",function(){return{templateUrl:"view/header/header.html"}}).directive("bsActiveLink",["$location",function(e){return{restrict:"A",replace:!1,link:function(n,r){n.$on("$routeChangeSuccess",function(){var n=["/#"+e.path(),"#"+e.path(),e.path()];angular.forEach(r.find("a"),function(e){e=angular.element(e),-1!==n.indexOf(e.attr("href"))?e.parent().addClass("active"):e.parent().removeClass("active")})})}}}]),angular.module("myApp.header",[]).controller("headerController",["$scope","AuthServices",function(e,n){e.logout=function(){n.logout()}}]),angular.module("myApp.homepage",[]).config(["$routeProvider",function(e){e.when("/",{authenticate:!0,templateUrl:"view/home/home.html",controller:"homepage"})}]).controller("homepage",["$scope","DataServices",function(e,n){$(".page").css("min-height",window.innerHeight-40+"px"),$(".home-page .loader-container .loader i").addClass("fa-spin"),n.getLastestData().then(function(n){$(".home-page .loader-container .loader i").removeClass("fa-spin"),$(".home-page .loader-container").hide(),e.data=n,e.contentLoading=!0},function(e){$(".home-page .loader-container .loader i").removeClass("fa-spin"),$(".home-page .loader-container").hide()})}]),angular.module("myApp.login",["ngRoute"]).config(["$routeProvider",function(e){e.when("/login",{authenticate:!1,templateUrl:"view/login/login.html",controller:"loginCtrl"})}]).controller("loginCtrl",["$scope","AuthServices",function(e,n){$(".page").css("min-height",window.innerHeight-40+"px"),e.login=function(){n.login({email:e.email,password:e.password}).then(function(e){},function(n){e.loginError=n})},e.createUser=function(){$(".signup-submit").prop("disabled",!0),n.checkSecret(e.secret).then(function(r){if(r.error)$(".signup-submit").prop("disabled",!1),console.log("wrong secret error"),e.secretError=!0;else{e.secretError=!1;var t={fullName:e.fullName,email:e.email,password:e.password};n.signup(t).then(function(n){$(".signup-submit").prop("disabled",!1),e.signupError=!1},function(n){$(".signup-submit").prop("disabled",!1),e.signupError=n.message})}})}}]),angular.module("myApp.search",[]).config(["$routeProvider",function(e){e.when("/search",{authenticate:!0,templateUrl:"view/search/search.html",controller:"searchCtrl"})}]).controller("searchCtrl",["$scope","$route","$routeParams","Auth","DataServices","$window","$location",function(e,n,r,t,a,o,i){$(".page").css("min-height",window.innerHeight-40+"px"),e.searchEquipement=function(n){n.$valid&&a.searchFunction(e.equipment).then(function(n){if(console.log(n),n){e.hasEquipment=!0,e.noEquipment=!1;var r=l(n);console.log(r),e.serials=r}else e.noEquipment=!0},function(e){console.log(e)})};var l=function(e){var n=$.map(e,function(e,n){return[e]});return n}}]),angular.module("myApp.tracking",["ngRoute"]).config(["$routeProvider",function(e){e.when("/tracking",{authenticate:!0,templateUrl:"view/tracking/tracking.html",controller:"trackingCtrl"})}]).controller("trackingCtrl",["$scope","$route","$routeParams","Auth","DataServices","$window","$location",function(e,n,r,t,a,o,i){$(".page").css("min-height",window.innerHeight-40+"px"),$(".tracking-page .loader-container .loader i").addClass("fa-spin");var l=t.getUserName();e.userName=l.userName,e.equipment=r.equipment,e.serial=r.serial,e.noData=!1,a.getLastestDataBySerial(r.equipment,r.serial).then(function(n){$(".tracking-page .loader-container .loader i").removeClass("fa-spin"),$(".tracking-page .loader-container").hide(),e.data=n,e.contentLoading=!0,n||(e.noData=!0)},function(e){$(".tracking-page .loader-container .loader i").removeClass("fa-spin"),$(".tracking-page .loader-container").hide()}),e.seeAllData=function(){e.contentLoading=!1,e.data={},$(".tracking-page .loader-container").show(),$(".tracking-page .loader-container .loader i").addClass("fa-spin"),a.getAllDataBySerial(r.equipment,r.serial).then(function(n){$(".tracking-page .loader-container .loader i").removeClass("fa-spin"),$(".tracking-page .loader-container").hide(),e.data=n,e.contentLoading=!0,e.allDataShowed=!0,n||(e.noData=!0)},function(e){$(".tracking-page .loader-container .loader i").removeClass("fa-spin"),$(".tracking-page .loader-container").hide()})},e.formSubmit=function(n){formData={userName:l.userName,equipment:r.equipment,serial:r.serial,location:e.testLocation,activity:e.activity,details:e.details},n.$valid&&(console.log(formData),a.saveData(formData).then(function(){e.formDataError=!1,$("#form-modal").modal("toggle"),o.location.reload()},function(n){e.formDataError="Something went wrong. Please try again"}))}}]);